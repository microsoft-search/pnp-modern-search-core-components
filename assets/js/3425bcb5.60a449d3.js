"use strict";(self.webpackChunksearchdoc=self.webpackChunksearchdoc||[]).push([[8119],{8210:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var t=s(4848),i=s(8453);const o={sidebar_position:2},a="Getting started",l={id:"development-guide/teams/getting_started",title:"Getting started",description:"Prerequisites",source:"@site/docs/development-guide/teams/getting_started.mdx",sourceDirName:"development-guide/teams",slug:"/development-guide/teams/getting_started",permalink:"/pnp-modern-search-core-components/docs/development-guide/teams/getting_started",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft-search/pnp-modern-search-core-components/tree/main/docs/development-guide/teams/getting_started.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"mainSidebar",previous:{title:"Solution overview",permalink:"/pnp-modern-search-core-components/docs/development-guide/teams/solution"},next:{title:"Teams application",permalink:"/pnp-modern-search-core-components/docs/category/teams-application-1"}},r={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Build the solution locally",id:"build-the-solution-locally",level:2},{value:"Deploy to Azure",id:"deploy-to-azure",level:3},{value:"Development notes",id:"development-notes",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"getting-started",children:"Getting started"}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://code.visualstudio.com/",children:"Visual Studio Code"})," with the following recommended extensions installed:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-bicep",children:"Bicep"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint",children:"ESLint"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=bradlc.vscode-tailwindcss",children:"Tailwind CSS IntelliSense"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell",children:"PowerShell"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=TeamsDevApp.ms-teams-vscode-extension",children:"Teams Toolkit"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Node.js v16.19.1 or higher"}),"\n",(0,t.jsxs)(n.li,{children:["TeamsFx CLI v2.0.1 (",(0,t.jsx)(n.code,{children:"npm i -g @microsoft/teamsfx@2.0.1"}),")"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"build-the-solution-locally",children:"Build the solution locally"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["In local mode, the Entra application is created and configured automatically according to the ",(0,t.jsx)(n.code,{children:"template/aad.manifest.template.json"})," file and provisioning steps in ",(0,t.jsx)(n.code,{children:"teamsapp.local.yml"}),". For more information refer to the ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/use-existing-aad-app",children:"TeamsFx documentation"}),"."]})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In the ",(0,t.jsx)(n.code,{children:"env/env.local"})," file, add the following values:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"TEAMSFX_ENV=local\nAPP_NAME_SUFFIX=local\n\nTAB_DOMAIN=localhost:53000\nTAB_ENDPOINT=https://localhost:53000\n\nAAD_APP_NAME=PnP Modern Search Components - DEV // Name on the application for local testing. This will be created and configured automatically by TeamsFx\nWEB_APP_SKU=F1 // = Free Tier\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["In the ",(0,t.jsx)(n.code,{children:".env"})," file at the root of the project, complete the following information:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'ENV_MSSearchAppClientId=<ID of the Entra app used for local testing> // You need to deploy once at least to get this ID\nENV_MSSearchAppScopes=["ExternalItem.Read.All","Files.Read.All","Sites.Read.All","Bookmark.Read.All","Acronym.Read.All","QnA.Read.All"]\n'})}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsxs)(n.p,{children:["This values are used to populate values in the ",(0,t.jsx)(n.code,{children:"apps.ts"})," files when bundling the application through Webpack. ",(0,t.jsx)(n.strong,{children:"They are not used by TeamsFx"})]}),(0,t.jsxs)(n.admonition,{title:"Client",type:"note",children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"webpack/app/webpack.common.js"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:"plugins: [  \n    ...\n    new webpack.EnvironmentPlugin(['ENV_MSSearchAppClientId', 'ENV_MSSearchAppScopes'])\n    ...\n]\n"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"app.ts"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"...\nconst graphScopes = JSON.parse(process.env.ENV_MSSearchAppScopes);\nconst clientId = process.env.ENV_MSSearchAppClientId;\n...  \n"})})]})]}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Run application by pressing F5 in Visual Studio Code. The Teams Toolkit will build the application a launch browser to add the Teams app:"}),"\n"]}),"\n",(0,t.jsxs)("div",{className:"center",style:{flexDirection:"column"},children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Local debug",src:s(3187).A+"",width:"1140",height:"554"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Teams app local",src:s(1168).A+"",width:"984",height:"775"})})]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"The Visual Studio debugger will be automatically attached to the Node.js process running the application."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The local server process is running in watch mode, meaning you can update content in ",(0,t.jsx)(n.code,{children:"src"})," folder and see results live in the Teams application (manual tab refresh is necessary)."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If you need to work on the web components at the same time (i.e. code in ",(0,t.jsx)(n.code,{children:"packages/components"}),"), you can run ",(0,t.jsx)(n.code,{children:"pnpm run build:watch"})," from the latter to build the components in watch mode. In this case, any modification made on components will trigger a new compilation on the Teams application."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If the server application is stopped for whatever reason, you can still restart it by running ",(0,t.jsx)(n.code,{children:"pnpm run serve"})," from the ",(0,t.jsx)(n.code,{children:"apps/teams"})," folder. You don't need to close the Teams application and press F5 again."]}),"\n"]}),"\n"]})}),"\n",(0,t.jsx)(n.h3,{id:"deploy-to-azure",children:"Deploy to Azure"}),"\n",(0,t.jsxs)(n.p,{children:["To deploy the application to Azure, create a new TeamsFx environment and use ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/@microsoft/teamsfx-cli",children:"TeamsFx"})," CLI to provision resources:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"teamsfx account login azure --service-principal --username <service_principal_app_id> --password <service_principal_app_secret> --tenant <tenant_id>\n\nteamsfx provision --env <env_name> --verbose\n\nteamsfx deploy --env<env_name>\n\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsxs)(n.p,{children:["By default, the Entra app is not created in the ",(0,t.jsx)(n.code,{children:"teamsapp.yml"})," so you have to create it manually."]}),(0,t.jsxs)(n.p,{children:["You also need a Microsoft 365 account to register the app in the teams developer portal (more info ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/use-cicd-template",children:"here"}),"). Define the following environment variables taht will be used by ",(0,t.jsx)(n.code,{children:"teamsapp.yml"})," file:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"$env:M365_TENANT_ID=<tenant_id>\n$env:M365_ACCOUNT_NAME=<account_name>\n$env:M365_ACCOUNT_PASSWORD=<account_password>\n"})}),(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"This account must have MFA deactivated and can be any valid Microsoft 365 account, even in a different Microsoft 365 tenant"}),"."]})]}),"\n",(0,t.jsx)(n.h2,{id:"development-notes",children:"Development notes"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:['TeamsFx version issues\nThe solution uses "@microsoft/teamsfx": "2.3.0" because of a bug introduced in the ',(0,t.jsx)(n.code,{children:"2.3.1"}),' version. Behind the scenes, it uses a new major version of the "@azure/msal-browser" package causing conflicts with Teams and failing the SSO authentication.']}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Webpack over tsc for Azure deployment"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["We use Webpack both server and client side to package Javascript code. For the server, it replaces the default tsc compilcation approach and /lib folder. The main reason is because of the monorepo structure used by the solution and ",(0,t.jsx)(n.code,{children:"pnpm"})," dependencies structure. When deploying to Azure or any other host and using a classic approach, the server application expects all modules to be available in a ",(0,t.jsx)(n.code,{children:"node_modules"})," folder uploaded along the server files.  Because pnpm uses symlinks to a root ",(0,t.jsx)(n.code,{children:"node_modules"}),' of the solution and does not "flatten" all modules, using this approach is likely impossible as modules are not resovled correctly. The solution is to bundle all dependencies into a single Javascript bundle and upload all necessary resources from a ',(0,t.jsx)(n.code,{children:"dist"})," folder."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Azure deployment with Express.js and HTTPS"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["When deploying to Azure, you need to tell the server to not use SLL. This part is actually handled by Azure directly. However, serving locally, the server needs to use a local self-signed certificate. That is why we use the env value ",(0,t.jsx)(n.code,{children:"RUNNING_ON_AZURE"})," to dynamically determine the behavior in the ",(0,t.jsx)(n.code,{children:"server.ts"})," file."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},3187:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/local_start-76b53056d7ec66b1d4c62e0f84e2685b.jpg"},1168:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/test_teams_app-ed34c1763e3768a4bc2cbfd0cdd36c2a.png"},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var t=s(6540);const i={},o=t.createContext(i);function a(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);